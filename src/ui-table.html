<link rel="import" href="../bower_components/core-list/core-list.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<polymer-element name="grid-cell" on-click="{{cellClicked}}" on-dblClick="{{cellDoubleClicked}}">
  
  <template>
    <content></content>
  </template>
  
</polymer-element>

<polymer-element name="grid-header" on-click="{{headerClicked}}" on-dblClick="{{headerDoubleClicked}}">
  
  <template>
    <content></content>
  </template>
  
</polymer-element>

<polymer-element name="grid-sort-header" attributes="col direction sortprop active" 
  on-click="{{ toggleDirection }}">

  <template>
    <content></content>  
    <content select="[sort-icon]"></content>  
  </template>

</polymer-element>

<polymer-element name="grid-sort-icon" attributes="direction">  
  
  <template>    
    <link rel="stylesheet" type="text/css" href="./ui-table.less">    
    <icon sort-asc hide?="{{ direction != 'asc' }}"></icon>
    <icon sort-desc hide?="{{ direction != 'desc' }}"></icon>
    <icon sort hide?="{{ direction }}"></icon>
  </template>

</polymer-element>

<polymer-element name="ui-table" attributes="value sort url rowheight src ignoredcols headers" on-grid-sort="{{sortColumn}}">
    
  <template>
    <link rel="stylesheet" type="text/css" href="./ui-table.less">
    <!-- content select out the overrides for default cell renderers -->    
    <content id="cell-default-override" select="[cell-default]"></content>
    <content id="columnOverrides" select="[column]"></content>
    <template id="header-default">
      <grid-header-item flex>
        <grid-sort-header sortprop="{{header}}" active="true" col="{{header}}">
          <div>
            {{ header }}
          </div> 
          <grid-sort-icon sort-icon></grid-sort-icon>          
        </grid-sort-header>
      </grid-header-item>
    </template>
    <template id="row-default">
      <grid-row horizontal layout style="height: {{ rowheight }}px;">
        <template repeat="{{ key in row | keys | remove(ignoredcols) }}">
          <grid-cell flex title="{{ row[key] }}" class="{{key}}">
            <template ref="{{userDefinedTemplates | findTemplate(key)}}" bind="{{}}"></template>
          </grid-cell>
        </template>
      </grid-row>
    </template>

    <template id="cell-default">      
      {{ row[key] }}
    </template>

    <grid>                
      <grid-header horizontal layout>
        <template repeat="{{ header in headers | remove(_ignoredcols) }}" ref="header-default"></template>        
      </grid-header> 
      <grid-body>  
        <core-list data="{{ _value }}" height="{{ rowheight }}">
          <template ref="row-default"></template>
        </core-list>      
      </grid-body>
    </grid>

    <core-ajax
      auto
      url="{{src}}"          
      handleAs="json"
      on-core-response="{{updateValue}}"></core-ajax>

  </template>

</polymer-element>

<script src="./ui-table.litcoffee"></script>